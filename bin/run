#! /usr/bin/env ruby

require_relative "../lib/copedent"

# TODO need to choose a CLI tools library
# === PER-RUN USER CONFIG ===

ROOT = "D"
TYPES = [:major, :minor, :dom7]
ENABLE_CLI = true
ENABLE_CSV = true
CSV_FILENAME = "#{TYPES.map(&:to_s).join("_")}_#{Time.now.to_i}_export.csv"

# high to low, add 1 to index to get to a string #
TUNING = ["E", "C#", "F#", "D", "B", "A", "F#", "E", "D", "C", "A", "D"]

# ========

def main
  key = Copedent::shift_key(to: ROOT)

  # the copedent is read column-wise, so to make partial calculations,
  # it only makes sense to do so in columnar blocks
  columns = (0..4)
    .map { |fret| Copedent::convert_fret(tuning: TUNING, key:, fret:) }
    .select { |fret| Copedent::has_valid_chord?(fret:, types: TYPES) }

  Copedent::print_to_terminal(columns:) if ENABLE_CLI
  Copedent::export_csv(columns:, filename: CSV_FILENAME) if ENABLE_CSV
end

main
